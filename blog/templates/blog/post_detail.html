{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
  <div class="card post">
    <h2>{{ post.title }}</h2>
    <p>{{ post.content|linebreaksbr }}</p>

    <div class="meta">
      {% if post.author %}<span>작성자: {{ post.author.username }}</span>{% endif %}
      <span>작성일: {{ post.created_at }}</span>
    </div>
  </div>

  <div class="hr"></div>

  <div class="card pad">
    <h2 style="margin:0 0 12px;">댓글</h2>

    {% if user.is_authenticated %}
      <form class="form" method="POST" action="{% url 'comment_create' post.pk %}">
        {% csrf_token %}
        <textarea name="content" placeholder="댓글을 입력하세요"></textarea>
        <button class="btn primary" type="submit">댓글 작성</button>
      </form>
    {% else %}
      <div class="helper">
        <span>댓글을 작성하려면 로그인하세요.</span>
        <a class="btn" href="{% url 'login' %}">로그인</a>
      </div>
    {% endif %}

    <div class="hr"></div>

    <div class="list">
      {% for c in comments %}
        <div class="comment">
          <div class="meta">
            <span><b>{{ c.author.username }}</b></span>
            <span>{{ c.created_at }}</span>
          </div>

          <div>{{ c.content|linebreaksbr }}</div>

          {% if user.is_authenticated %}
            {% if c.author == user or user.is_superuser %}
              <div class="hr"></div>
              <form method="POST" action="{% url 'comment_delete' post.pk c.pk %}">
                {% csrf_token %}
                <button class="btn danger" type="submit">댓글 삭제</button>
              </form>
            {% endif %}
          {% endif %}
        </div>
      {% empty %}
        <div class="comment">댓글이 없습니다.</div>
      {% endfor %}
    </div>

    <div class="helper">
      <a class="btn" href="{% url 'post_list' %}">목록으로</a>
    </div>
  </div>
{% endblock %}
